<!DOCTYPE html>
<html lang="lo">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ລະບົບຕິດຕາມການຊຳລະເງີນຫໍພັກ</title>
  <meta name="description" content="ຕິດຕາມການຊຳລະເງີນຫໍພັກ ງ່າຍ ໄວ ແລະປອດໄພ">
  
  <!-- ໃຊ້ ./ ເພື່ອໃຫ້ໝາຍເຖິງໄຟລ໌ໃນ directory ດຽວກັນ -->
  <link rel="manifest" href="./manifest.json" />
  <!-- ປ່ຽນ icon ໄປໃຊ້ URL ທີ່ໃຊ້ງານໄດ້ -->
  <link rel="icon" href="https://i.ibb.co/k6SJLcCQ/icon-512.png" />
  
  <meta name="theme-color" content="#2e9a57">
  <style>
    :root {
      --green: #2e9a57;
      --green-dark: #1f6c3b;
      --green-light: #e8f7ee;
      --text-dark: #133a23;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Noto Sans Lao', sans-serif; }
    body {
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: linear-gradient(180deg, var(--green-light), #fff);
      color: var(--text-dark);
    }
    .card {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 24px;
      padding: 32px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1);
      max-width: 380px;
      width: 90%;
      animation: fadeIn 1s ease;
    }
    .logo img {
      width: 100px;
      height: 100px;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }
    h1 {
      font-size: 22px;
      color: var(--green);
      margin-bottom: 10px;
      font-weight: 800;
    }
    p {
      font-size: 14px;
      color: #3f614a;
      margin-bottom: 24px;
    }
    button {
      appearance: none;
      border: none;
      padding: 12px 18px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 700;
      width: 100%;
      transition: 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--green), var(--green-dark));
      color: white;
      margin-bottom: 10px;
    }
    .btn-primary:hover { transform: translateY(-2px); }
    .btn-install {
      background: transparent;
      color: var(--green-dark);
      border: 2px solid var(--green);
    }
    footer {
      margin-top: 30px;
      font-size: 13px;
      color: #2f5f3f;
      text-align: center;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="logo">
      <img src="https://i.ibb.co/k6SJLcCQ/icon-512.png" alt="icon-512">
    </div>
    <h1>ລະບົບຕິດຕາມການຊຳລະເງີນຫໍພັກ</h1>
   <p>ພະແນກແຜນການແລະການລົງທືນແຂວງ</p>
    <button class="btn-primary" id="openApp">ໄປທີ່ຫນ້າຫຼັກລະບົບ...</button>
    <button class="btn-install" id="installApp">ຕິດຕັ້ງແອັບ(PWA)</button>
  </div>
  <footer>© <span id="year"></span> ພັດທະນາໂດຍ: MR.bounPherng</footer>

  <script>
    const APP_URL = 'https://script.google.com/macros/s/AKfycbwSUnF8DjqKm1jfLVCvKQ7ZCiB5RwnJ5EVi8-xHTbOZD1UU_hz-rUaIfrlHZuDWCWz8/exec';
    document.getElementById('year').textContent = new Date().getFullYear();

    document.getElementById('openApp').addEventListener('click', () => {
      window.open(APP_URL, '_blank');
    });

    let deferredPrompt;
    const installBtn = document.getElementById('installApp');
    installBtn.style.display = 'none';

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });

    installBtn.addEventListener('click', async () => {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        const result = await deferredPrompt.userChoice;
        deferredPrompt = null;
      } else {
        // ບໍ່ໃຊ້ alert() ເພາະອາດຈະບໍ່ເຮັດວຽກໃນບາງສະຖານະການ
        console.warn("ບໍ່ສາມາດຕິດຕັ້ງໄດ້, ກະລຸນາໃຊ້ 'Add to Home screen' ຈາກเมนู Chrome.");
      }
    });

    // ປັບປຸງການລົງທະບຽນ service worker ໃຫ້ແນ່ນອນວ່າໃຊ້ path ຖືກຕ້ອງ
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js') // ໃຊ້ ./
          .then(registration => {
            console.log('Service Worker registered: ', registration);
          })
          .catch(error => {
            console.log('Service Worker registration failed: ', error);
          });
      });
    }

  </script>
  
</body>
</html>
